<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bruno Andreis</title>
    
    <!-- Stylesheets: Main styles, timeline component, and media component -->
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="timeline.css">
    <link rel="stylesheet" href="media.css">
</head>
<body>
    <!-- Scroll anchor for top of page -->
    <div id="top"></div>
    
    <main>
        <!-- ============================ -->
        <!--           HEADER              -->
        <!-- ============================ -->
        <header class="header">
            <a href="#top" class="name-link">
                <div class="name" id="site-name">Loading‚Ä¶</div>
            </a>
            <nav class="nav-links" id="nav-links">
                <button id="theme-toggle" class="theme-toggle" aria-label="Toggle dark mode">üåô</button>
            </nav>
        </header>

        <!-- ============================ -->
        <!--       PROFILE SECTION         -->
        <!-- ============================ -->
        <section class="profile-section">
            <div class="profile-container">
                <!-- Left sidebar with image, role, and social links -->
                <aside class="profile-sidebar">
                    <div class="profile-image">
                        <img src="images/profile_picture.jpg" alt="Profile Picture">
                        <div class="nationality-flags">üáøüá¶ üá®üá≠</div>
                    </div>
                    <div class="profile-role">
                        <h3 class="role-title" id="role-title">Loading‚Ä¶</h3>
                        <p class="role-affiliation" id="role-affiliation">Loading‚Ä¶</p>
                    </div>
                    <div class="profile-socials" id="profile-socials"></div>
                </aside>
                
                <!-- Main profile content/bio -->
                <div class="profile-text" id="profile-content">
                    <p>Loading...</p>
                </div>
            </div>
        </section>
        <!-- ============================ -->
        <!--       TIMELINE SECTION        -->
        <!-- ============================ -->
        <section id="timeline" class="timeline-section">
            <div id="timeline-list" class="timeline-container"></div>
        </section>

        <!-- ============================ -->
        <!--        MEDIA SECTION          -->
        <!-- ============================ -->
        <div class="section-header">
            <h1 id="media-heading">Loading‚Ä¶</h1>
        </div>

        <section id="media" class="media-section">
            <div id="media-list" class="media-grid"></div>
        </section>

        <!-- ============================ -->
        <!--    PUBLICATIONS SECTION       -->
        <!-- ============================ -->
        <div class="section-header">
            <h1 id="publications-heading">Loading‚Ä¶</h1>
            <p class="publications-note">
                Please see my <a href="https://scholar.google.com/citations?user=WaZWY0wAAAAJ&hl=en" target="_blank">Google Scholar</a> 
                for a complete list of publications.
            </p>
        </div>

        <section id="pubs" class="publications">
            <div id="publications-list"></div>
        </section>

        <!-- ============================ -->
        <!--         BLOG SECTION          -->
        <!-- ============================ -->
        <div class="section-header">
            <h1 id="blog-heading">Loading‚Ä¶</h1>
            <p style="text-align: center; color: var(--muted-color); font-size: 16px; margin-top: 8px; max-width: 600px; margin-left: auto; margin-right: auto;">
                Welcome to my blog, where I write about the things.
            </p>
        </div>

        <section id="blog" class="blog-section">
            <div id="blog-list"></div>
        </section>
    </main>

    <!-- ============================ -->
    <!--           FOOTER              -->
    <!-- ============================ -->
    <footer>
        <p>&copy; <span id="footer-year">2025</span> <span id="footer-name">Loading‚Ä¶</span>. All rights reserved.</p>
        <p id="footer-tagline" style="margin-top: 8px; font-style: italic;">Loading‚Ä¶</p>
    </footer>

    <!-- ============================ -->
    <!--         JAVASCRIPT            -->
    <!-- ============================ -->
    <script>
        /**
         * ===================================================================
         *                    CONTENT LOADING FUNCTIONS
         * ===================================================================
         */

        /**
         * Load site metadata (name, role, affiliation) from site.json
         * Updates the site name, role title, affiliation, and footer name
         */
        async function loadSiteMetadata() {
            try {
                const response = await fetch('content/profile/site.json');
                const siteData = await response.json();
                
                // Update site name in header and page title
                const siteNameElement = document.getElementById('site-name');
                if (siteNameElement && siteData.siteName) {
                    siteNameElement.textContent = siteData.siteName;
                    document.title = siteData.siteName;
                }
                
                // Update role information
                const roleTitleElement = document.getElementById('role-title');
                const roleAffiliationElement = document.getElementById('role-affiliation');
                if (roleTitleElement && siteData.role?.title) {
                    roleTitleElement.textContent = siteData.role.title;
                }
                if (roleAffiliationElement && siteData.role?.affiliation) {
                    roleAffiliationElement.textContent = siteData.role.affiliation;
                }
                
                // Update footer name
                const footerNameElement = document.getElementById('footer-name');
                if (footerNameElement && siteData.footerName) {
                    footerNameElement.textContent = siteData.footerName;
                }
            } catch (error) {
                console.error('Error loading site metadata:', error);
            }
        }

        /**
         * Load layout configuration for navigation and section titles
         * Updates navigation links, section headings, and footer content
         */
        async function loadLayoutConfiguration() {
            try {
                const response = await fetch('config/layout.json');
                const layoutConfig = await response.json();
                
                // Build navigation menu
                const navLinksElement = document.getElementById('nav-links');
                if (navLinksElement && layoutConfig.header?.navigation) {
                    // Preserve theme toggle button
                    const themeButton = navLinksElement.querySelector('#theme-toggle');
                    navLinksElement.innerHTML = '';
                    
                    // Add navigation links
                    layoutConfig.header.navigation.forEach(navItem => {
                        const linkElement = document.createElement('a');
                        linkElement.href = navItem.href;
                        linkElement.innerHTML = navItem.label; // Use innerHTML to support HTML tags like <b>
                        navLinksElement.appendChild(linkElement);
                    });
                    
                    // Re-add theme toggle button
                    if (themeButton) {
                        navLinksElement.appendChild(themeButton);
                    }
                }
                
                // Update section titles
                const updateSectionTitle = (elementId, configPath) => {
                    const element = document.getElementById(elementId);
                    const title = configPath.split('.').reduce((obj, key) => obj?.[key], layoutConfig);
                    if (element && title) {
                        element.innerHTML = title;
                    }
                };
                
                updateSectionTitle('publications-heading', 'sections.publications.title');
                updateSectionTitle('blog-heading', 'sections.blog.title');
                updateSectionTitle('media-heading', 'sections.media.title');
                
                // Update footer content
                const footerTaglineElement = document.getElementById('footer-tagline');
                const footerYearElement = document.getElementById('footer-year');
                
                if (footerTaglineElement && layoutConfig.footer?.tagline) {
                    footerTaglineElement.textContent = layoutConfig.footer.tagline;
                }
                if (footerYearElement && layoutConfig.footer?.year) {
                    footerYearElement.textContent = layoutConfig.footer.year;
                }
            } catch (error) {
                console.error('Error loading layout configuration:', error);
            }
        }

        /**
         * Load profile content from site.json or fallback to bio.md
         * Converts markdown formatting to HTML for display
         */
        async function loadProfileContent() {
            try {
                // First try to load profile from site.json
                const siteResponse = await fetch('content/profile/site.json');
                const siteData = await siteResponse.json();
                
                let markdownContent;
                
                if (siteData.profile) {
                    // Use profile content from site.json
                    markdownContent = siteData.profile;
                } else {
                    // Fallback to bio.md file
                    const bioResponse = await fetch('content/profile/bio.md');
                    markdownContent = await bioResponse.text();
                }
                
                // Convert markdown to HTML
                const htmlContent = convertSimpleMarkdownToHtml(markdownContent);
                document.getElementById('profile-content').innerHTML = htmlContent;
                
            } catch (error) {
                console.error('Error loading profile content:', error);
            }
        }

        /**
         * Convert basic markdown formatting to HTML
         * Handles bold text, links, and paragraph breaks
         * @param {string} markdown - Raw markdown text
         * @returns {string} HTML formatted text
         */
        function convertSimpleMarkdownToHtml(markdown) {
            return markdown
                .replace(/\*\*([^*]+)\*\*/g, '<strong>$1</strong>')  // Bold text
                .replace(/\[([^\]]+)\]\(([^)]+)\)/g, '<a href="$2" target="_blank">$1</a>')  // Links
                .replace(/\n\n+/g, '</p><p>')  // Paragraph breaks
                .replace(/^/, '<p>')  // Start with paragraph
                .replace(/$/, '</p>');  // End with paragraph
        }

        /**
         * Load social links from contacts.json and create clickable icons
         * Handles both emoji and image-based social icons
         */
        async function loadSocialLinks() {
            try {
                const response = await fetch('content/profile/contacts.json');
                const contacts = await response.json();
                const socialsContainer = document.getElementById('profile-socials');
                
                contacts.forEach(contact => {
                    const socialLink = document.createElement('a');
                    socialLink.href = contact.url;
                    socialLink.target = '_blank';
                    socialLink.className = 'social-link';
                    socialLink.title = contact.name;
                    
                    if (contact.isImage) {
                        // Use image icon
                        socialLink.innerHTML = `<img src="${contact.icon}" alt="${contact.name}" class="social-icon-img">`;
                    } else {
                        // Use emoji icon
                        socialLink.innerHTML = `<span class="social-icon">${contact.icon}</span>`;
                    }
                    
                    socialsContainer.appendChild(socialLink);
                });
            } catch (error) {
                console.error('Error loading social links:', error);
            }
        }

        /**
         * Load publications from publications.json and render publication cards
         * Creates interactive publication entries with available resource buttons
         */
        async function loadPublications() {
            try {
                const response = await fetch('content/publications/publications.json');
                const publications = await response.json();
                const listContainer = document.getElementById('publications-list');
                
                publications.forEach(pub => {
                    // Build buttons HTML for available resources
                    let buttonsHTML = '';
                    const buttons = [
                        { key: 'paper', label: 'Paper', url: pub.paper || pub.link },
                        { key: 'code', label: 'Code', url: pub.code },
                        { key: 'poster', label: 'Poster', url: pub.poster },
                        { key: 'slides', label: 'Slides', url: pub.slides },
                        { key: 'video', label: 'Video', url: pub.video },
                        { key: 'demo', label: 'Demo', url: pub.demo }
                    ];
                    
                    const availableButtons = buttons.filter(btn => btn.url);
                    if (availableButtons.length > 0) {
                        buttonsHTML = '<div class="pub-buttons">' + 
                            availableButtons.map(btn => 
                                `<a href="${btn.url}" class="pub-button" target="_blank" onclick="event.stopPropagation()">${btn.label}</a>`
                            ).join('') + 
                        '</div>';
                    }
                    
                    // Bold author name and format conference
                    let formattedAuthors = pub.authors.replace(/\bF\. Fehr\b/g, '<strong>F. Fehr</strong>');
                    
                    const pubHTML = `
                    <div class="publication" onclick="window.open('${pub.paper || pub.link}', '_blank')">
                        <div class="pub-image">
                            <img src="${pub.image}" alt="${pub.title}">
                        </div>
                        <div class="pub-description">
                            <h2>${pub.title}</h2>
                            <p>${formattedAuthors}</p>
                            <p>${pub.venue}</p>
                            <p><b class='pub-conference'>${pub.conference}</b></p>
                            ${buttonsHTML}
                        </div>
                    </div>
                    `;
                    listContainer.innerHTML += pubHTML;
                });
            } catch (error) {
                console.error('Error loading publications:', error);
            }
        }

        /**
         * Load blog posts from blogs.json and create blog post previews
         * Renders blog cards with titles, dates, and excerpts
         */
        async function loadBlogs() {
            try {
                const response = await fetch('content/blogs/blogs.json');
                const blogs = await response.json();
                const listContainer = document.getElementById('blog-list');
                
                blogs.forEach(blog => {
                    const blogHTML = `
                    <a href="blogs.html?id=${blog.id}" style="text-decoration:none;">
                    <div class="blog-post">
                        <div class="blog-image">
                            <img src="${blog.thumbnail}" alt="${blog.title}">
                        </div>
                        <div class="blog-description">
                            <h2>${blog.title}</h2>
                            <p class="blog-date">${new Date(blog.date).toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' })}</p>
                            <p>${blog.excerpt}</p>
                        </div>
                    </div>
                    </a>
                    `;
                    listContainer.innerHTML += blogHTML;
                });
            } catch (error) {
                console.error('Error loading blogs:', error);
            }
        }

        /**
         * Load design configuration and apply CSS custom properties
         * Sets layout variables, typography, and image sizing from design.json
         */
        async function loadDesignConfiguration() {
            try {
                const resp = await fetch('config/design.json');
                if (!resp.ok) return;
                const cfg = await resp.json();
                
                // Layout variables
                if (cfg.layout) {
                    if (cfg.layout.maxWidth) {
                        const val = cfg.layout.maxWidth.value;
                        const unit = cfg.layout.maxWidth.unit || 'px';
                        document.documentElement.style.setProperty('--maxw', val + unit);
                    }
                }
                
                // Typography variables
                if (cfg.typography) {
                    if (cfg.typography.body) {
                        if (cfg.typography.body.lineHeight) {
                            document.documentElement.style.setProperty('--body-line-height', cfg.typography.body.lineHeight.value);
                        }
                    }
                }
                
                // Image variables
                const pub = cfg.images && cfg.images.publicationThumbnail;
                if (pub) {
                    // Use a fixed-width x fixed-height box so text aligns; image preserves aspect ratio inside
                    const w = pub.width && pub.width.value ? pub.width.value : null;
                    const wUnit = pub.width && pub.width.unit ? pub.width.unit : 'px';
                    const h = pub.height && pub.height.value ? pub.height.value : null;
                    const hUnit = pub.height && pub.height.unit ? pub.height.unit : 'px';
                    const br = pub.borderRadius || '4px';
                    if (w) document.documentElement.style.setProperty('--pub-thumb-width', w + wUnit);
                    if (h) document.documentElement.style.setProperty('--pub-thumb-height', h + hUnit);
                    document.documentElement.style.setProperty('--pub-thumb-radius', br);
                }
            } catch (error) {
                console.error('Error loading design config:', error);
            }
        }

        /**
         * ===================================================================
         *                    THEME TOGGLE FUNCTIONALITY
         * ===================================================================
         */

        // Initialize theme toggle functionality
        const themeToggle = document.getElementById('theme-toggle');
        const htmlElement = document.documentElement;
        
        // Check for saved theme preference or system preference
        const savedTheme = localStorage.getItem('theme') || (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light');
        
        // Apply saved theme
        if (savedTheme === 'dark') {
            htmlElement.setAttribute('data-theme', 'dark');
            themeToggle.textContent = '‚òÄÔ∏è';
        } else {
            htmlElement.setAttribute('data-theme', 'light');
            themeToggle.textContent = 'üåô';
        }
        
        // Toggle theme on button click
        themeToggle.addEventListener('click', () => {
            const currentTheme = htmlElement.getAttribute('data-theme');
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            
            htmlElement.setAttribute('data-theme', newTheme);
            localStorage.setItem('theme', newTheme);
            themeToggle.textContent = newTheme === 'dark' ? '‚òÄÔ∏è' : 'üåô';
        });

        /**
         * ===================================================================
         *                    INITIALIZATION
         * ===================================================================
         */

        // Load all content on page load
        // Load layout and design configurations first so CSS variables are available
        loadLayoutConfiguration();
        loadSiteMetadata();
        loadDesignConfiguration();
        loadProfileContent();
        loadSocialLinks();
        loadPublications();
        loadBlogs();
    </script>
    <script src="timeline.js"></script>
    <script src="media.js"></script>
</body>
</html>